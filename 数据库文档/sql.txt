CREATE DATABASE memorizing CHARSET utf8;
USE memorizing;
/*附件表*/
CREATE TABLE attach(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '附件id',
	file_name VARCHAR(30) NOT NULL COMMENT '文件名',
	file_location TEXT NOT NULL COMMENT '文件位置',
	type TINYINT UNSIGNED NOT NULL COMMENT '文件类型（0为头像，1为文件）',
	gmt_create DATETIME NOT NULL COMMENT '创建时间'
)CHARSET utf8 ENGINE INNODB;
/*任务表*/
CREATE TABLE task(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '任务id',
	content TEXT NOT NULL COMMENT '任务内容',
	file BIGINT UNSIGNED NOT NULL COMMENT '任务文件',
	gmt_create DATETIME NOT NULL COMMENT '创建时间',
	gmt_end DATETIME NOT NULL COMMENT '结束时间',
	is_use TINYINT UNSIGNED NOT NULL COMMENT '使用标记',
	CONSTRAINT fk_task_attach FOREIGN KEY(file) REFERENCES attach(id)
)CHARSET utf8 ENGINE INNODB;
/*用户表*/
CREATE TABLE `user`(
	account VARCHAR(30) PRIMARY KEY COMMENT '帐号',
	pwd VARCHAR(30) NOT NULL COMMENT '密码',
	nickname VARCHAR(30) NOT NULL COMMENT '昵称',
	gender TINYINT UNSIGNED NOT NULL COMMENT '性别',
	age TINYINT UNSIGNED NOT NULL COMMENT '年龄',
	portrait BIGINT UNSIGNED NOT NULL COMMENT '头像',
	task BIGINT UNSIGNED NOT NULL COMMENT '当前任务',
	score BIGINT UNSIGNED NOT NULL COMMENT '分数',
	gmt_create DATETIME NOT NULL COMMENT '注册时间',
	CONSTRAINT fk_user_attach FOREIGN KEY(portrait) REFERENCES attach(id),
	CONSTRAINT fk_user_task FOREIGN KEY(task) REFERENCES task(id)
)CHARSET utf8 ENGINE INNODB;
/*管理员表*/
CREATE TABLE manager(
	account VARCHAR(30) PRIMARY KEY COMMENT '帐号',
	pwd VARCHAR(30) NOT NULL COMMENT '密码',
	nickname VARCHAR(30) NOT NULL COMMENT '昵称',
	gmt_create DATETIME NOT NULL COMMENT '注册时间'
)CHARSET utf8 ENGINE INNODB;

/*任务重点表*/
CREATE TABLE `key`(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '文件重点id',
	task BIGINT UNSIGNED NOT NULL COMMENT '任务',
	point TEXT NOT NULL COMMENT '重点',
	gmt_create DATETIME NOT NULL COMMENT '创建时间',
	CONSTRAINT fk_key_task FOREIGN KEY(task) REFERENCES task(id)
)CHARSET utf8 ENGINE INNODB;

/*文件分类表*/
CREATE TABLE classify(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '文件分类id',
	`name` VARCHAR(30) NOT NULL COMMENT '分类名',
	`user` VARCHAR(30) NOT NULL COMMENT '分类用户帐号',
	gmt_create DATETIME NOT NULL COMMENT '创建时间',
	CONSTRAINT fk_classify_user FOREIGN KEY(`user`) REFERENCES `user`(account)
)CHARSET utf8 ENGINE INNODB;

/*阶段任务表*/
CREATE TABLE task_stage(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '阶段任务id',
	content TEXT NOT NULL COMMENT '阶段任务内容',
	task BIGINT UNSIGNED NOT NULL COMMENT '大任务',
	step TINYINT UNSIGNED NOT NULL COMMENT '所属阶段',
	gmt_create DATETIME NOT NULL COMMENT '创建时间',
	gmt_end DATETIME NOT NULL COMMENT '结束时间',
	is_use TINYINT UNSIGNED NOT NULL COMMENT '使用标记',
	CONSTRAINT fk_stage_task FOREIGN KEY(task) REFERENCES task(id)
)CHARSET utf8 ENGINE INNODB;

/*任务填空表*/
CREATE TABLE task_blank(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '任务填空id',
	content TEXT NOT NULL COMMENT '任务填空内容',
	task_stage BIGINT UNSIGNED NOT NULL COMMENT '阶段任务',
	gmt_create DATETIME NOT NULL COMMENT '创建时间',
	CONSTRAINT fk_blank_stage FOREIGN KEY(task_stage) REFERENCES task_stage(id)
)CHARSET utf8 ENGINE INNODB;

/*推送消息表*/
CREATE TABLE message(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '推送消息id',
	content TEXT NOT NULL COMMENT '推送消息内容',
	`user` VARCHAR(30) NOT NULL COMMENT '被推送人',
	gmt_push DATETIME NOT NULL COMMENT '推送时间',
	CONSTRAINT fk_message_user FOREIGN KEY(`user`) REFERENCES `user`(account)
)CHARSET utf8 ENGINE INNODB;

/*分析报告表*/
CREATE TABLE report(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '分析报告id',
	content TEXT NOT NULL COMMENT '分析报告内容',
	`user` VARCHAR(30) NOT NULL COMMENT '被分析人',
	gmt_create DATETIME NOT NULL COMMENT '创建时间',
	CONSTRAINT fk_report_user FOREIGN KEY(`user`) REFERENCES `user`(account)
)CHARSET utf8 ENGINE INNODB;

/*历史任务表*/
CREATE TABLE history(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '历史任务id',
	task BIGINT UNSIGNED NOT NULL COMMENT '任务',
	is_finish TINYINT UNSIGNED NOT NULL COMMENT '任务完成标记，1为完成，0为未完成',
	`user` VARCHAR(30) NOT NULL COMMENT '任务人',
	gmt_finish DATETIME NOT NULL COMMENT '完成时间',
	CONSTRAINT fk_history_user FOREIGN KEY(`user`) REFERENCES `user`(account),
	CONSTRAINT fk_history_task FOREIGN KEY(task) REFERENCES task(id)
)CHARSET utf8 ENGINE INNODB;

/*成就表*/
CREATE TABLE achievement(
	id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '成就id',
	`condition` TINYINT UNSIGNED NOT NULL COMMENT '成就条件',
	content TEXT NOT NULL COMMENT '成就内容',
	creator VARCHAR(30) NOT NULL COMMENT '创建人',
	gmt_create DATETIME NOT NULL COMMENT '创建时间',
	CONSTRAINT fk_achievement_manager FOREIGN KEY(creator) REFERENCES manager(account)
)CHARSET utf8 ENGINE INNODB;